import{_ as f,o,c as r,b as t,f as p,a as _,F as m,e as g,t as h,g as I,v as b}from"./index-99b8cc40.js";const{VITE_APP_URL:d,VITE_APP_PATH:i}={VITE_APP_URL:"https://vue3-course-api.hexschool.io/",VITE_APP_PATH:"leo533",BASE_URL:"/Vue3-week6/",MODE:"production",DEV:!1,PROD:!0},C={data(){return{products:[],productId:"",cart:{},loadingItem:"",form:{email:"",name:"",phone:"",address:"",msg:""}}},methods:{getCarts(){const e=this.$loading.show();this.$http.get(`${d}/v2/api/${i}/cart`).then(s=>{this.products=s.data.products,this.cart=s.data.data,e.hide()}).catch(s=>{alert(s.response.data.message)})},updateCartItem(e){const s={product_id:e.product.id,qty:e.qty};this.loadingItem=e.id,this.$http.put(`${d}/v2/api/${i}/cart/${e.id}`,{data:s}).then(u=>{this.getCarts(),this.loadingItem="",alert("商品數量已更新！")}).catch(u=>{alert(u.response.data.message)})},deleteItem(e){this.loadingItem=e.id,this.$http.delete(`${d}/v2/api/${i}/cart/${e.id}`).then(s=>{this.getCarts(),this.loadingItem="",alert("該商品已經清空")}).catch(s=>{alert(s.response.data.message)})},clearCart(){this.cart.carts.length===0?alert("購物車清單內為空"):(this.loadingItem="deleteAll",this.$http.delete(`${d}/v2/api/${i}/carts`).then(e=>{this.getCarts(),this.loadingItem="",alert("購物車已清空")}).catch(e=>{alert(e.response.data.message)}))},changeLoading(e){this.loadingItem=e},sendOrder(){if(this.cart.carts.length===0)alert("購物車清單內為空");else{const e={user:{name:this.form.name,email:this.form.email,tel:this.form.phone,address:this.form.address},message:this.form.msg};this.$http.post(`${d}/v2/api/${i}/order`,{data:e}).then(s=>{this.getCarts(),this.loadingItem="",this.$refs.form.resetForm(),alert("訂單已送出")}).catch(s=>{alert(s.response.data.message)})}},validateTelephone(e){return/^(09)[0-9]{8}$/.test(e)?!0:"需要正確的手機號碼"}},mounted(){this.getCarts()}},v={class:"text-end"},y=["disabled"],$={key:0,class:"fas fa-spinner fa-pulse"},V={class:"table align-middle"},x=t("thead",null,[t("tr",null,[t("th"),t("th",null,"品名"),t("th",{style:{width:"150px"}},"數量/單位"),t("th",null,"單價")])],-1),P=["onClick","disabled"],k={key:0,class:"fas fa-spinner fa-pulse"},A={class:"input-group input-group-sm"},E=["onUpdate:modelValue","onChange","disabled"],T=["value","Key"],w={class:"text-end"},D=t("td",{colspan:"3",class:"text-end"},"總計",-1),L={class:"text-end"},N=t("tr",null,null,-1);function U(e,s,u,q,l,c){return o(),r(m,null,[t("div",v,[t("button",{class:"btn btn-outline-danger",type:"button",onClick:s[0]||(s[0]=(...a)=>c.clearCart&&c.clearCart(...a)),disabled:l.loadingItem==="deleteAll"},[l.loadingItem==="deleteAll"?(o(),r("i",$)):p("",!0),_(" 清空購物車 ")],8,y)]),t("table",V,[x,t("tbody",null,[l.cart.carts?(o(!0),r(m,{key:0},g(l.cart.carts,a=>(o(),r("tr",{key:a.id},[t("td",null,[t("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:n=>c.deleteItem(a),disabled:a.id===l.loadingItem},[l.loadingItem===a.id?(o(),r("i",k)):p("",!0),_(" x ")],8,P)]),t("td",null,h(a.product.title)+" ",1),t("td",null,[t("div",A,[I(t("select",{name:"",id:"",class:"form-select","onUpdate:modelValue":n=>a.qty=n,onChange:n=>c.updateCartItem(a),disabled:a.id===l.loadingItem},[(o(),r(m,null,g(20,n=>t("option",{value:n,Key:n+"45678"},h(n),9,T)),64))],40,E),[[b,a.qty]])])]),t("td",w,h(a.total),1)]))),128)):p("",!0)]),t("tfoot",null,[t("tr",null,[D,t("td",L,h(l.cart.total),1)]),N])])],64)}const R=f(C,[["render",U]]);export{R as default};
